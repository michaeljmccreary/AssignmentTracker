<div class="form-wrapper">
  <div class="form-container">
    <div class="form-card">
      <p style="color: green"><%= notice %></p>

      <% content_for :title, "My Assignments" %>

      <h1 class="page-title mb-4">ğŸ“š My Assignments</h1>

      <!-- Filter Section -->
      <div class="card home-card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">ğŸ” Filter Assignments</h5>
          <%= form_with url: assignments_path, method: :get, local: true do |f| %>
            <div class="row g-3">
              <div class="col-md-4">
                <%= f.label :status, "Status", class: "form-label" %>
                <%= f.select :status, 
                  options_for_select([
                    ['All Statuses', 'all'],
                    ['Not started', 'Not started'],
                    ['In progress', 'In progress'],
                    ['Completed', 'Completed']
                  ], params[:status] || 'all'), 
                  {}, 
                  class: "form-select" 
                %>
              </div>
              <div class="col-md-4">
                <%= f.label :classroom_id, "Classroom", class: "form-label" %>
                <%= f.select :classroom_id,
                  options_for_select([['All Classrooms', 'all']] + @classrooms.map { |c| [c.name, c.id] }, params[:classroom_id] || 'all'),
                  {},
                  class: "form-select"
                %>
              </div>
              <div class="col-md-4">
                <%= f.label :sort_by, "Sort By", class: "form-label" %>
                <%= f.select :sort_by,
                  options_for_select([
                    ['Newest First', 'created_at'],
                    ['Due Date', 'due_date']
                  ], params[:sort_by] || 'created_at'),
                  {},
                  class: "form-select"
                %>
              </div>
            </div>
            <div class="mt-3">
              <%= f.submit "Apply Filters", class: "btn btn-primary" %>
              <%= link_to "Clear Filters", assignments_path, class: "btn btn-secondary" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Assignments by Status -->
      <% if @assignments.any? %>
        <% ['Not started', 'In progress', 'Completed'].each do |status| %>
          <% status_assignments = @assignments.select { |a| a.status == status } %>
          <% if status_assignments.any? %>
            <div class="mb-4">
              <h4 class="mb-3">
                <%= case status
                  when 'Not started' then 'âšª'
                  when 'In progress' then 'ğŸŸ¡'
                  when 'Completed' then 'âœ…'
                end %>
                <%= status %> (<%= status_assignments.count %>)
              </h4>
              
              <div class="row">
                <% status_assignments.each do |assignment| %>
                  <div class="col-md-6 mb-3">
                    <div class="card home-card h-100">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                          <h5 class="card-title mb-0">ğŸ“ <%= assignment.title %></h5>
                          <span class="badge <%= case assignment.status
                            when 'Completed' then 'bg-success'
                            when 'In progress' then 'bg-warning'
                            else 'bg-secondary'
                          end %>"><%= assignment.status %></span>
                        </div>
                        
                        <p class="card-text mb-2">
                          <small class="text-muted">
                            <strong>ğŸ“š Classroom:</strong> <%= assignment.classroom.name %><br>
                            <strong>ğŸ“… Due:</strong> <%= assignment.due_date.strftime("%b %d, %Y") %>
                            <% days_until = (assignment.due_date - Date.today).to_i %>
                            <% if days_until < 0 %>
                              <span class="text-danger">(Overdue)</span>
                            <% elsif days_until == 0 %>
                              <span class="text-warning">(Due today!)</span>
                            <% elsif days_until <= 3 %>
                              <span class="text-warning">(Due soon)</span>
                            <% end %>
                          </small>
                        </p>

                        <div class="mb-3">
                          <small><strong>Progress:</strong></small>
                          <div class="progress" style="height: 20px;">
                            <div class="progress-bar <%= 
                              if assignment.progress >= 75
                                'bg-success'
                              elsif assignment.progress >= 50
                                'bg-info'
                              elsif assignment.progress >= 25
                                'bg-warning'
                              else
                                'bg-danger'
                              end
                            %>" role="progressbar" style="width: <%= assignment.progress %>%;">
                              <%= assignment.progress %>%
                            </div>
                          </div>
                        </div>

                        <% if assignment.description.present? %>
                          <p class="card-text mb-3">
                            <small><%= truncate(assignment.description, length: 100) %></small>
                          </p>
                        <% end %>

                        <div class="d-flex gap-2">
                          <%= link_to "View", assignment, class: "btn btn-sm btn-primary" %>
                          <%= link_to "Edit", edit_assignment_path(assignment), class: "btn btn-sm btn-outline-primary" %>
                          <%= button_to "Delete", assignment, method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-outline-danger" %>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="text-center py-5">
          <h3 class="text-muted">No assignments found!</h3>
          <p class="text-muted">
            <% if params[:status].present? || params[:classroom_id].present? %>
              Try adjusting your filters or add a new assignment.
            <% else %>
              Add your first assignment to get started.
            <% end %>
          </p>
        </div>
      <% end %>

      <div class="text-center mt-4">
        <%= link_to "ğŸ”™ Back to Classrooms", classrooms_path, class: "btn btn-secondary btn-lg" %>
      </div>
    </div>
  </div>
</div>
